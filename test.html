<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>
<script type="text/javascript">
  function swap(arr, i, j) {
    let tmp = arr[i];
    arr[i] = arr[j];
    arr[j] = tmp;
  }

  function buildMaxHeap(arr, comp) {
    let i;
    let len = arr.length;
    for (i = Math.floor(len / 2) - 1; i >= 0; i--) {
      heapAdjust(arr, i, len, comp);
    }
  }

  function heapAdjust(arr, nodeIndex, len, comp) {
    len = len || arr.length;
    let stack = [nodeIndex];
    let i;
    let largest;
    let left;
    let right;
    while (stack.length) {
      i = stack.pop();
      largest = i;
      left = 2 * i + 1;
      right = 2 * i + 2;

      if (left < len && comp(arr[largest], arr[left]) < 0) {
        largest = left;
      }

      if (right < len && comp(arr[largest], arr[right]) < 0) {
        largest = right;
      }

      if (largest !== i) {
        swap(arr, i, largest);
        stack.push(largest);
      }
    }
  }

  function heap(comp) {
    let arr = this;
    let len = arr.length;
    buildMaxHeap(arr, comp);
    for (let i = len - 1; i > 0; i--) {
      swap(arr, 0, i);
      heapAdjust(arr, 0, i, comp);
    }

    return arr;
  }

  var z = [0,1,3,3,3,3,3,3,3,999,-10,4,5,6,7,9]
  //var z = [1, 999, -10, 7, 9]
  var r = heap.call(z, function (a, b) {
    return -(a - b)
  })
  console.log(r)
</script>
</body>
</html>
